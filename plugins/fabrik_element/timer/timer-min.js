var FbTimer=new Class({options:{defaultVal:"",editable:false,startCrono:"15:00",endCrono:"00:00",div:false,stopOnComplete:true,onComplete:function(){},onEveryMinute:function(){},onEveryHour:function(){}},Extends:FbElement,initialize:function(d,c){this.plugin="fabriktimer";this.parent(d,c);var a=$(this.options.element+"_button");this.seg=0;this.min=0;this.hour=0;if(this.options.autostart===true){if(typeOf(a)!=="null"){a.value=Joomla.JText._("PLG_ELEMENT_TIMER_STOP")}this.start()}else{this.state="paused"}this.incremental=1;if(typeOf(a)!=="null"){a.addEvent("click",function(f){f.stop();if(this.state==="started"){this.pause();a.value=Joomla.JText._("PLG_ELEMENT_TIMER_START")}else{var b=this.element.value.split(":");switch(b.length){case 3:this.hour=(b[0]==="")?0:b[0].toInt();this.min=(b[1]==="")?0:b[1].toInt();this.seg=(b[2]==="")?0:b[2].toInt();break;case 2:this.min=(b[0]==="")?0:b[0].toInt();this.seg=(b[1]==="")?0:b[1].toInt();break;case 1:this.seg=(b[0]==="")?0:b[0].toInt();break}this.start();a.value=Joomla.JText._("PLG_ELEMENT_TIMER_STOP")}}.bind(this))}},start:function(){if(this.state!=="started"){this.timer=this.count.periodical(1000,this);this.state="started"}},pause:function(){if(this.state!=="paused"){clearInterval(this.timer);this.state="paused"}},count:function(){this.seg+=this.incremental;if((this.seg===-1)||(this.seg===60)){this.seg=(this.incremental>0)?0:59;this.min+=this.incremental;if(this.min===-1||this.min===60){this.min=(this.incremental>0)?0:59;this.hour+=this.incremental}}this.element.value=this.time();if((this.min===this.endMin)&&(this.seg===this.endSeg)){this.fireEvent("onComplete","");if(this.options.stopOnComplete){this.pause()}}},time:function(){var a=(this.hour<10)?"0"+this.hour:this.hour;a+=((this.min<10)?":0":":")+this.min;a+=((this.seg<10)?":0":":")+this.seg;return a},reset:function(){start_array=this.options.startCrono.split(":");end_array=this.options.endCrono.split(":");this.startMin=start_array[0].toInt();this.startSeg=start_array[1].toInt();this.endMin=end_array[0].toInt();this.endSeg=end_array[1].toInt();if(this.endMin!==this.startMin){this.incremental=(this.endMin>this.startMin)?1:-1}else{this.incremental=(this.endSeg>this.startSeg)?1:-1}this.min=this.startMin;this.seg=this.startSeg;if(this.options.div!==false){document.id(this.options.div).set("text",this.time())}}});