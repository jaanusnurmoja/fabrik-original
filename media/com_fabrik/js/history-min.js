var History=new Class({initialize:function(a,b){this.recording=true;this.pointer=-1;if($(a)){$(a).addEvent("click",this.undo.bindWithEvent(this))}if($(b)){$(b).addEvent("click",this.redo.bindWithEvent(this))}Fabrik.addEvent("fabrik.history.on",this.on.bindWithEvent(this));Fabrik.addEvent("fabrik.history.off",this.off.bindWithEvent(this));Fabrik.addEvent("fabrik.history.add",this.add.bindWithEvent(this));this.history=$A([])},undo:function(){if(this.pointer>-1){this.off();var b=this.history[this.pointer];var c=b.undofunc;var d=b.undoparams;var a=c.attempt(d,b.object);this.on();this.pointer--}},redo:function(){if(this.pointer<this.history.length-1){this.pointer++;this.off();var b=this.history[this.pointer];var c=b.redofunc;var d=b.redoparams;var a=c.attempt(d,b.object);this.on()}},add:function(e,d,f,b,a){if(this.recording){var c=this.history.filter(function(i,g){return g<=this.pointer}.bind(this));this.history=c;this.history.push({object:e,undofunc:d,undoparams:f,redofunc:b,redoparams:a});this.pointer++}},on:function(){this.recording=true},off:function(){this.recording=false}});