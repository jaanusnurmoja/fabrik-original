var Pages=new Class({initialize:function(a,b){this.editable=b;document.addEvent("mousedown",this.clearActive.bindWithEvent(this));Fabrik.addEvent("fabrik.page.add",this.makeActive.bindWithEvent(this));this.pages=$H({});this.activePage=null;this.container=document.id(a);Fabrik.addEvent("fabrik.tab.add",this.add.bindWithEvent(this));Fabrik.addEvent("fabrik.tab.click",this.show.bindWithEvent(this));Fabrik.addEvent("fabrik.tab.remove",this.remove.bindWithEvent(this));Fabrik.addEvent("fabrik.keynav",this.moveItem.bindWithEvent(this));Fabrik.addEvent("fabrik.inline.save",this.updateTabKey.bindWithEvent(this))},makeActive:function(d){this.clearActive();d.addClass("active");this.active=d;var b=document.getElements(".itemPlaceHolder").getStyle("z-index").sort();var a=b.getLast().toInt()+1;document.getElements(".itemPlaceHolder").each(function(c){c.setStyle("zindex",c.getStyle("z-index").toInt()-1)});d.setStyle("z-index",a)},clearActive:function(){delete this.active;document.getElements(".itemPlaceHolder").removeClass("active")},moveItem:function(b,a){if(this.active&&this.editable){a=a?10:0;var c=this.active.getCoordinates(this.getActivePage().page);switch(b){case 37:this.active.setStyle("left",c.left-2-a);break;case 38:this.active.setStyle("top",c.top-2-a);break;case 39:this.active.setStyle("left",c.left+1+a);break;case 40:this.active.setStyle("top",c.top+1+a);break}}},add:function(b,a){var c=new Page(a,this.editable);this.container.adopt(c.page);c.show();this.pages[a]=c;this.show()},remove:function(b,a){a=a.retrieve("ref");delete this.pages.t;this.pages.erase(a)},show:function(b){this.pages.each(function(d){d.hide()});try{this.pages[b].show();this.activePage=b}catch(c){var a=this.pages.getKeys();if(a.length>0){b=a[0];this.pages[b].show();this.activePage=b}}},getHTMLPages:function(){var a=[];this.pages.each(function(b){a.push(b.page)});return a},getActivePage:function(){if(!this.activePage){this.activePage=0}return this.pages[this.activePage]},fromJSON:function(a){$H(a).each(function(b,c){if(this.pages[c]){$H(b).each(function(d,e){this.pages[c].insert(d.id,d.label,d.type,d.dimensions)}.bind(this))}}.bind(this))},toJSON:function(){var a={};this.pages.each(function(c,b){var d={};c.page.getElements(".itemPlaceHolder").each(function(h){c.page.show();var g=h.id.split("_")[0];var f=h.getElement(".handlelabel").get("text");d[h.id]={dimensions:h.getCoordinates(c.page),label:f,type:g,id:h.id}});a[b.trim()]=d});return a},updateTabKey:function(a){var b=a.retrieve("origValue").trim();var c=this.pages[b];this.pages[a.get("text").trim()]=c;delete this.pages[b];this.pages.erase(b)}});Page=new Class({initialize:function(b,a){this.editable=a;this.page=new Element("div",{"class":"page",styles:{display:"none"}});if(this.editable){Fabrik.addEvent("fabrik.item.resized",this.saveCoords.bindWithEvent(this));Fabrik.addEvent("fabrik.item.moved",this.saveCoords.bindWithEvent(this))}},show:function(){this.page.show()},hide:function(){this.page.hide()},remove:function(){this.page.destroy()},removeItem:function(a,b){a.stop();if(confirm("Do you really want to delete")){$(b).destroy();Fabrik.fireEvent("fabrik.page.block.delete",[b])}},insert:function(d,a,b,c){Fabrik.fireEvent("fabrik.page.insert",[this,d,a,b,c])},saveCoords:function(a){}});